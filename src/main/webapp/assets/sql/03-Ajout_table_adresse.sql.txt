USE ENCHERES
ALTER TABLE [dbo].[UTILISATEURS] DROP CONSTRAINT [FK_Utilisateur_Adresse]
GO
ALTER TABLE [dbo].[RETRAITS] DROP CONSTRAINT [FK_Retrait_Adresse]
GO
IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ADRESSES]') AND type in (N'U'))
DROP TABLE [dbo].[ADRESSES]
GO
CREATE TABLE ADRESSES (
    id   INTEGER IDENTITY CONSTRAINT pk_adresse PRIMARY KEY,
    rue              VARCHAR(30) NOT NULL,
    code_postal      VARCHAR(10) NOT NULL,
    ville            VARCHAR(30) NOT NULL

);
GO
ALTER TABLE UTILISATEURS ADD adresse_id INTEGER;
ALTER TABLE UTILISATEURS WITH CHECK ADD CONSTRAINT FK_Utilisateur_Adresse FOREIGN KEY (adresse_id) REFERENCES ADRESSES(id);
GO
ALTER TABLE RETRAITS ADD adresse_id INTEGER;
ALTER TABLE RETRAITS WITH CHECK ADD CONSTRAINT FK_Retrait_Adresse FOREIGN KEY (adresse_id) REFERENCES ADRESSES(id);
GO
INSERT INTO ADRESSES (rue, code_postal, ville) VALUES ('Rue Montgalet',75000,'PARIS'),('Rue Truc',22000,'BRETAGNE'),('Rue Bidule',22000,'VILLE');
GO
UPDATE UTILISATEURS SET adresse_id = 1 WHERE no_utilisateur = 1;
UPDATE UTILISATEURS SET adresse_id = 2 WHERE no_utilisateur = 2;
UPDATE UTILISATEURS SET adresse_id = 3 WHERE no_utilisateur = 3;
GO
ALTER TABLE UTILISATEURS ALTER COLUMN adresse_id INTEGER NOT NULL;
ALTER TABLE RETRAITS ALTER COLUMN adresse_id INTEGER NOT NULL;
GO